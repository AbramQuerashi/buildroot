This branch shows how to compile and run a kernel module inside QEMU.

https://stackoverflow.com/questions/32124246/build-run-linux-kernel-module-on-qemu/38813400#38813400

Usage:

    make qemu_x86_64_defconfig
    echo 'BR2_PACKAGE_KERNEL_MODULE=y' >> .config
    make BR2_JLEVEL=2
    qemu-system-x86_64 -M pc -kernel output/images/bzImage -drive file=output/images/rootfs.ext2,if=virtio,format=raw -append root=/dev/vda -net nic,model=virtio -net user

From inside qemu:

    root
    cd /
    insmod kernel_module.ko
    # init_module
    dmesg | tail -n1
    rmmod kernel_module.ko
    # cleanup_module
    dmesg | tail -n1
